
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ProShields Estimator – Editable</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      background: #f3f4f6;
    }
    .app {
      max-width: 520px;
      margin: 0 auto;
      background: #ffffff;
      padding: 16px;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }
    .header {
      text-align: center;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #e5e7eb;
    }
    .header-title {
      font-size: 20px;
      margin: 0;
    }
    .header-sub {
      font-size: 12px;
      color: #6b7280;
      margin: 4px 0 0 0;
    }
    label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
    }
    select, input {
      width: 100%;
      padding: 8px 10px;
      font-size: 15px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    .row {
      display: flex;
      gap: 8px;
    }
    .row > div {
      flex: 1;
    }
    .card {
      background: #f9fafb;
      border-radius: 10px;
      padding: 12px;
      margin-top: 10px;
      border: 1px solid #e5e7eb;
    }
    .card h2 {
      font-size: 16px;
      margin: 0 0 8px 0;
    }
    .line {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin: 2px 0;
    }
    .big {
      font-size: 18px;
      font-weight: 600;
      margin-top: 6px;
    }
    .small {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }
    .total-card {
      margin-top: 12px;
      background: #ecfeff;
      border-color: #06b6d4;
    }
    .admin-toggle {
      margin-top: 16px;
      text-align: center;
    }
    .btn {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #0f766e;
      background: #0d9488;
      color: white;
      font-size: 13px;
      cursor: pointer;
    }
    .btn.secondary {
      background: white;
      color: #0f172a;
      border-color: #cbd5f5;
    }
    .admin-panel {
      margin-top: 12px;
      display: none;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 4px;
      text-align: left;
    }
    th {
      background: #f3f4f6;
      font-weight: 600;
    }
    .admin-input {
      width: 100%;
      padding: 4px 6px;
      font-size: 11px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      box-sizing: border-box;
    }
    .admin-actions {
      text-align: right;
      margin-top: 8px;
    }
    .hint {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <p class="header-title">ProShields Quick Estimator</p>
      <p class="header-sub">Solo eliges servicio y pones números. Todo lo demás se calcula solo.</p>
    </div>

    <label for="serviceSelect">Service</label>
    <select id="serviceSelect"></select>

    <div class="row">
      <div>
        <label for="qtyInput">Quantity</label>
        <input type="number" id="qtyInput" min="0" step="1" placeholder="Ej: 220">
        <div class="hint" id="unitHint"></div>
      </div>
      <div>
        <label for="discountInput">Discount %</label>
        <input type="number" id="discountInput" min="0" max="100" step="1" value="0">
      </div>
    </div>

    <div class="card">
      <h2>Calculation</h2>
      <div class="line">
        <span>Unit price</span>
        <span id="unitPriceText">$0.00</span>
      </div>
      <div class="line">
        <span>Subtotal</span>
        <span id="subtotalText">$0.00</span>
      </div>
      <div class="line">
        <span>Discount</span>
        <span id="discountAmtText">-$0.00</span>
      </div>
      <div class="line big">
        <span>Total</span>
        <span id="totalText">$0.00</span>
      </div>
      <div class="small">
        Los precios y unidades (sq ft, linear ft, each, etc.) se editan en el panel de administración de abajo.
      </div>
    </div>

    <div class="card total-card">
      <div class="line">
        <span>Total to say to client</span>
        <span id="clientTotalText">$0.00</span>
      </div>
      <div class="small">
        Puedes redondear mentalmente antes de decirlo (ej: 8,945 → 8,900 o 8,950).
      </div>
    </div>

    <div class="admin-toggle">
      <button class="btn secondary" id="toggleAdminBtn">Show admin (edit services & prices)</button>
    </div>

    <div class="admin-panel" id="adminPanel">
      <div class="card">
        <h2 style="margin-top:0;">Admin – Services & Prices</h2>
        <div class="small">
          Edita nombre del servicio, unidad (sq ft, linear ft, each, etc.) y precio. Se guarda en este dispositivo.
        </div>
        <table>
          <thead>
            <tr>
              <th style="width:40%;">Service name</th>
              <th style="width:25%;">Unit label</th>
              <th style="width:20%;">Unit price</th>
            </tr>
          </thead>
          <tbody id="servicesTableBody"></tbody>
        </table>
        <div class="admin-actions">
          <button class="btn secondary" id="resetBtn">Reset to default</button>
          <button class="btn" id="saveBtn">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Default config (all prices = 1, units empty so you can edit)
    const defaultServices = [
      "Screen Room",
      "Lanai (Screen Porch)",
      "Pergola",
      "Pool Enclosure",
      "Screen Cage",
      "Screen Enclosure",
      "Decorative Wall",
      "Accent Wall",
      "Accent Decoration",
      "Re-screen",
      "Rescreen on Pool Enclosure",
      "Rescreen on Screen Porch / Lanai",
      "Single Screen Panel Replacement",
      "20/20 Screen",
      "Florida Glass Screen (Privacy Screen)",
      "Other Special Screen",
      "Door (New)",
      "Door Replacement",
      "Vinyl Window / Vinyl Door",
      "Glass Window / Glass Door",
      "Super Gutter",
      "Super Gutter Replacement",
      "Kickplate",
      "Pool Enclosure Repair",
      "Pressure Washing",
      "Concrete Floor",
      "Footer",
      "Sod / Grass Removal",
      "Fastener Replacement",
      "Fan Install",
      "LED Lights Install"
    ];

    const STORAGE_KEY = "proshields_estimator_config_v1";

    function loadConfig() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          return defaultServices.map((name, index) => ({
            id: "svc" + index,
            name,
            unitLabel: "",
            unitPrice: 1
          }));
        }
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed) || parsed.length === 0) throw new Error("bad");
        return parsed;
      } catch (e) {
        return defaultServices.map((name, index) => ({
          id: "svc" + index,
          name,
          unitLabel: "",
          unitPrice: 1
        }));
      }
    }

    function saveConfig(services) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(services));
    }

    let services = loadConfig();

    // DOM elements
    const serviceSelect     = document.getElementById("serviceSelect");
    const qtyInput          = document.getElementById("qtyInput");
    const discountInput     = document.getElementById("discountInput");
    const unitHint          = document.getElementById("unitHint");

    const unitPriceText     = document.getElementById("unitPriceText");
    const subtotalText      = document.getElementById("subtotalText");
    const discountAmtText   = document.getElementById("discountAmtText");
    const totalText         = document.getElementById("totalText");
    const clientTotalText   = document.getElementById("clientTotalText");

    const toggleAdminBtn    = document.getElementById("toggleAdminBtn");
    const adminPanel        = document.getElementById("adminPanel");
    const servicesTableBody = document.getElementById("servicesTableBody");
    const saveBtn           = document.getElementById("saveBtn");
    const resetBtn          = document.getElementById("resetBtn");

    function formatMoney(value) {
      return "$" + value.toFixed(2);
    }

    function populateServiceSelect() {
      serviceSelect.innerHTML = "";
      services.forEach((svc, idx) => {
        const opt = document.createElement("option");
        opt.value = svc.id;
        opt.textContent = svc.name || ("Service " + (idx + 1));
        serviceSelect.appendChild(opt);
      });
    }

    function getCurrentService() {
      const id = serviceSelect.value;
      return services.find(s => s.id === id) || services[0];
    }

    function calculate() {
      const svc = getCurrentService();
      const price = parseFloat(svc.unitPrice) || 0;
      const qty = parseFloat(qtyInput.value) || 0;
      const discountPercent = parseFloat(discountInput.value) || 0;

      const subtotal = qty * price;
      const discountAmount = subtotal * (discountPercent / 100);
      const total = subtotal - discountAmount;

      unitPriceText.textContent   = formatMoney(price);
      subtotalText.textContent    = formatMoney(subtotal);
      discountAmtText.textContent = "-" + formatMoney(discountAmount);
      totalText.textContent       = formatMoney(total);
      clientTotalText.textContent = formatMoney(total);

      unitHint.textContent = svc.unitLabel
        ? ("Unit: " + svc.unitLabel)
        : "Unit: (edit in admin if you want sq ft, linear ft, each, etc.)";
    }

    function populateAdminTable() {
      servicesTableBody.innerHTML = "";
      services.forEach((svc, index) => {
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        const nameInput = document.createElement("input");
        nameInput.type = "text";
        nameInput.value = svc.name;
        nameInput.className = "admin-input";
        nameInput.dataset.index = index;
        nameInput.dataset.field = "name";
        tdName.appendChild(nameInput);

        const tdUnit = document.createElement("td");
        const unitInput = document.createElement("input");
        unitInput.type = "text";
        unitInput.value = svc.unitLabel || "";
        unitInput.placeholder = "sq ft / linear ft / each";
        unitInput.className = "admin-input";
        unitInput.dataset.index = index;
        unitInput.dataset.field = "unitLabel";
        tdUnit.appendChild(unitInput);

        const tdPrice = document.createElement("td");
        const priceInput = document.createElement("input");
        priceInput.type = "number";
        priceInput.step = "0.01";
        priceInput.min = "0";
        priceInput.value = svc.unitPrice;
        priceInput.className = "admin-input";
        priceInput.dataset.index = index;
        priceInput.dataset.field = "unitPrice";
        tdPrice.appendChild(priceInput);

        tr.appendChild(tdName);
        tr.appendChild(tdUnit);
        tr.appendChild(tdPrice);

        servicesTableBody.appendChild(tr);
      });
    }

    function readAdminTable() {
      const inputs = servicesTableBody.querySelectorAll(".admin-input");
      inputs.forEach(input => {
        const index = parseInt(input.dataset.index, 10);
        const field = input.dataset.field;
        if (!services[index]) return;
        if (field === "unitPrice") {
          services[index][field] = parseFloat(input.value) || 0;
        } else {
          services[index][field] = input.value;
        }
      });
    }

    // Events
    serviceSelect.addEventListener("change", calculate);
    qtyInput.addEventListener("input", calculate);
    discountInput.addEventListener("input", calculate);

    toggleAdminBtn.addEventListener("click", () => {
      const visible = adminPanel.style.display === "block";
      adminPanel.style.display = visible ? "none" : "block";
      toggleAdminBtn.textContent = visible
        ? "Show admin (edit services & prices)"
        : "Hide admin";
    });

    saveBtn.addEventListener("click", () => {
      readAdminTable();
      saveConfig(services);
      populateServiceSelect();
      calculate();
      alert("Changes saved on this device.");
    });

    resetBtn.addEventListener("click", () => {
      if (!confirm("Reset all services to default list with price = 1?")) return;
      services = defaultServices.map((name, index) => ({
        id: "svc" + index,
        name,
        unitLabel: "",
        unitPrice: 1
      }));
      saveConfig(services);
      populateServiceSelect();
      populateAdminTable();
      calculate();
    });

    // Initial setup
    populateServiceSelect();
    populateAdminTable();
    calculate();
  </script>
</body>
</html>
